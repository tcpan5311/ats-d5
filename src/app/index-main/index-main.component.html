
<!-- <p-blockUI [target]="body" [blocked]="blockedPanel"><p-progressSpinner></p-progressSpinner></p-blockUI> -->
<div #body>

<br>
<div class="header">
    <p-menubar [model]="items">
        <div>
            <button type="button" icon="pi pi-wallet" pButton label="{{connectButtonLabel}}" style="margin-left:.25em" (click)="openKeystoreModal()"
            [disabled]="accountLoaded == true"></button>
        </div>
    </p-menubar>
</div>

<p-toast key="t1" position="bottom-right"></p-toast> 
<br>

<div class="grid">

<div class="col-2 col-md-2">
</div>

<div class = "col-5 col-md-5  main-form">
    <p-card header="Send">


        <form [formGroup]="TokenFormGroup" (ngSubmit)="sendTransaction()">

            <div class="p-inputgroup">
                
                <span class="p-inputgroup-addon">ETH</span>
                <input type="text" pInputText placeholder="Amount"
                formControlName="inputAmount" class="form-control">   
                <!-- <span class="p-inputgroup-addon">.00</span>      -->
                <br>
            
            </div>

            <div *ngIf="f.inputAmount?.touched && f.inputAmount?.invalid">
                <p-message *ngIf="f.inputAmount.errors?.required" severity="error" text="Amount is required."></p-message>
                <p-message *ngIf="f.inputAmount.errors?.pattern" severity="error" text="Invalid format"></p-message>
                <p-message *ngIf="f.inputAmount.errors?.max" severity="error" text="Amount cannot be greater than 10000"></p-message>
            </div>
        
            <br>
        
            <div class="p-inputgroup input-address">
                    <span class="p-inputgroup-addon"><i class="pi pi-user"></i></span>
                    <input type="text" pInputText placeholder="Address"
                    formControlName="inputAddress" class="form-control">         
            </div>

            <div *ngIf="f.inputAddress?.touched && f.inputAddress?.invalid">
                <p-message *ngIf="f.inputAddress.errors?.required" severity="error" text="Address is required."></p-message>
                <p-message *ngIf="f.inputAddress.errors?.addressValid" severity="error" text="Invalid address format"></p-message>
            </div>
        
            <br>

            <!-- <button #btnSend type="button" icon="pi pi-send" pButton label="Send" type="submit"></button> -->
            <button #btnSend type="button" icon="pi pi-send" pButton label="Send" type="submit" [disabled]="!TokenFormGroup.valid"></button>

        </form>

    
    </p-card>
</div>

<div class="col-2 col-md-2">
</div>


<div class="col-3 col-md-3">
    <p-card header="Wallet Info" subheader="{{panelAddressLabel}}">
        <p>{{panelBalanceLabel}}</p>
        <p-button icon="pi pi-times" *ngIf= "accountLoaded == true" (click)="disconnectWallet()" label="Disconnect wallet" class="p-button-text"></p-button>
    </p-card>
</div>

<div class="col-8 col-md-8">
</div>

<div class = "col-4 col-md-4">
    <p-panel header="Transaction history">

        <p-scrollPanel [style]="{height: '200px'}">

        <p *ngIf="txs.length == 0 && accountLoaded == false">
            Transaction not available, please connect to your wallet
        </p>
        
        <p *ngIf="txs.length == 0 && accountLoaded == true">
            There are no transaction
        </p>

         <p *ngFor="let tx of txs;">
           From: {{tx.fromAddress}}<br>
           To: {{tx.toAddress}}<br>
           Amount: {{tx.amount}} Ether<br>
           Timestamp: {{tx.timestamp}}<br>
           <p-divider></p-divider>
          </p>

          </p-scrollPanel>

    </p-panel>
</div>
   

</div>

<p-dialog header="Import wallet" [(visible)]="displayModal" [modal]="true" [style]="{width: '50vw'}" [baseZIndex]="10000"
    [draggable]="false" [resizable]="false">
    <p-messages [(value)]="modal_msg"></p-messages> 
    <p class="p-m-0">Please select your keystore file to import wallet.</p>
    <p-fileUpload #fileUpload 
    mode="basic" 
    chooseLabel="Browse"
    accept=".txt" 
    [auto]="true" 
    [maxFileSize]="1000000" 
    [customUpload]="true" 

    (uploadHandler)="onUploadFile($event,fileUpload)">
    </p-fileUpload>

     <br>
    <p-button icon="pi pi-times" *ngIf="uploadedFiles.length != 0" (click)="removeUpload()" label="Remove" class="p-button-text"></p-button>

    <ng-template pTemplate="content">
        <div *ngIf="uploadedFiles.length">
            <p *ngFor="let file of uploadedFiles">File selected: {{file.name}} - {{file.size}} bytes</p>
        </div>
    </ng-template>

        <ng-template pTemplate="footer">
            <p-button icon="pi pi-check" (click)="importWallet()" label="Import" class="p-button-text"></p-button>
        </ng-template>
</p-dialog>
</div>

<p-dialog header="Transaction review" [(visible)]="txReviewModal" [modal]="true" [style]="{width: '50vw'}" [baseZIndex]="10000"
    [draggable]="false" [resizable]="false">

    <p-card>

        <p-divider align="left">
            <div class="p-d-inline-flex p-ai-center">
                <b>Addresses</b>
              </div>
        </p-divider>

        <div class="flex flex-row flex-wrap card-container">
            <div class="col-5 col-md-5">
                <button pButton pRipple [disabled] = "disableClick == true" type="button" icon="pi pi-user" label="Sender: 0x880B0 ... 55d4459" class="p-button-rounded p-button-secondary p-button-outlined"></button>
            </div>

            <div class="col-1 col-md-1 fee-modal-arrow-right">
                <button pButton pRipple [disabled] = "disableClick == true" type="button" icon="pi pi-arrow-right" class="p-button-rounded p-button-secondary p-button-outlined"></button>
            </div>

            <div class="col-5 col-md-5">
                <button pButton pRipple [disabled] = "disableClick == true" type="button" icon="pi pi-user" label="Receiver: 0x880B0 ... 55d4459" class="p-button-rounded p-button-secondary p-button-outlined"></button>
            </div>
        </div>

        <p-divider align="left">
            <div class="p-d-inline-flex p-ai-center">
                <b>Site name</b>
              </div>
        </p-divider>

            <p>
            {{txReviewModalSiteLabel}}
            </p>
            <button pButton pRipple type="button" label="Send Ether" [disabled] = "disableClick == true" class="p-button-outlined p-button-secondary"></button>
            <br>

            <div class="flex flex-row flex-wrap card-container">
                <div class="eth-currency-icon">
                    <img src="../../assets/img/ethCurrency.png" style="width: 25px; height: 25px;">
                </div>

                <div>
                    <h2>{{txReviewAmountLabel}}</h2>
                </div>
            </div>
        
        <p-divider align="left">
                <b>Fee structure</b>
        </p-divider>

        <p>Estimated gas fee</p>

    </p-card>
</p-dialog>



